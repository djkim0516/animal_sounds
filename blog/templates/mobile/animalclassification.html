
<!-- static 파일 사용 선언 -->
{% load static %}

{% block content %}



<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Animal Classification</title>

    <!-- Fontfaces CSS-->
    <link href="{% static 'css/css/font-face.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="{% static 'js/vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="{% static 'js/vendor/animsition/animsition.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/wow/animate.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/css-hamburgers/hamburgers.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/slick/slick.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/select2/select2.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'js/vendor/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{% static 'css/css/theme.css' %}" rel="stylesheet" media="all">

</head>


<!-- HEADER MOBILE-->
        <header class="header-mobile header-mobile-2 d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="" style="font-size:24px;">
                            Animal Classification
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-tachometer-alt"></i>Dashboard</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="index.html">Dashboard 1</a>
                                </li>
                                <li>
                                    <a href="index2.html">Dashboard 2</a>
                                </li>
                                <li>
                                    <a href="index3.html">Dashboard 3</a>
                                </li>
                                <li>
                                    <a href="index4.html">Dashboard 4</a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="chart.html">
                                <i class="fas fa-chart-bar"></i>Charts</a>
                        </li>
                        <li>
                            <a href="table.html">
                                <i class="fas fa-table"></i>Tables</a>
                        </li>
                        <li>
                            <a href="form.html">
                                <i class="far fa-check-square"></i>Forms</a>
                        </li>
                        <li>
                            <a href="calendar.html">
                                <i class="fas fa-calendar-alt"></i>Calendar</a>
                        </li>
                        <li>
                            <a href="map.html">
                                <i class="fas fa-map-marker-alt"></i>Maps</a>
                        </li>
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-copy"></i>Pages</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="login.html">Login</a>
                                </li>
                                <li>
                                    <a href="register.html">Register</a>
                                </li>
                                <li>
                                    <a href="forget-pass.html">Forget Password</a>
                                </li>
                            </ul>
                        </li>
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-desktop"></i>UI Elements</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="">Button</a>
                                </li>
                                <li>
                                    <a href="">Badges</a>
                                </li>
                                <li>
                                    <a href="">Tabs</a>
                                </li>
                                <li>
                                    <a href="">Cards</a>
                                </li>
                                <li>
                                    <a href="">Alerts</a>
                                </li>
                                <li>
                                    <a href="">Progress Bars</a>
                                </li>
                                <li>
                                    <a href="">Modals</a>
                                </li>
                                <li>
                                    <a href="">Switchs</a>
                                </li>
                                <li>
                                    <a href="">Grids</a>
                                </li>
                                <li>
                                    <a href="">Fontawesome Icon</a>
                                </li>
                                <li>
                                    <a href="">Typography</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        
        <!-- END HEADER MOBILE -->
<!--
<div class="div_wrap">
	<div class="content">

      <h1 style="font-family: 'Noto Sans KR'; font-size: 2.5em; margin-top: 1em; margin-bottom: 1em;">오디오 입력</h1>
        <form id="mForm" action="/animalclassificationresult/" method="POST" class="post-form" enctype="multipart/form-data"style="
    margin: auto;">
          {% csrf_token %}

          <div class="filebox"> <input class="upload-name" value="파일선택" disabled="disabled"> 
            <label for="id_soundfile" style="margin-bottom: 0px;">업로드</label> 
            <input type="file" name="soundfile" id="id_soundfile" class="upload-hidden"> 
        </div>

            <br>
           <button id="sub_but" type="submit" class="btn btn-success" onclick=_showPage(); style="font-size: 2em;">분석하기</button>
      </form>
              <div id="waveform"></div>
              <div id="controlBar">
                  <div class="control_bar_row">
                      <div id="curTime" class="time-indicator" style="font-size: 1.5em;">00:00:00</div>
                      <div class="time-indicator-divider"style="font-size: 1.5em;">/</div>
                      <div id="fullTime" class="time-indicator"style="font-size: 1.5em;">00:00:00</div>
                      
                  </div>
                  <div class="control_bar_row">
                      <button id="play" class="video-play"style="width: 26px;    height: 26px;"></button>
                      <button id="stop" class="video-stop"style="width: 26px;    height: 26px;"></button>
                  </div>

              </div>
      </div>

  </div>-->

  <div class="div_wrap">
    <div class="content">

      <h1 style="font-family: 'Noto Sans KR'; font-size: 2.5em; margin-top: 1em; margin-bottom: 1em;">오디오 입력</h1>
        <form id="mForm" action="/animalclassificationresult/" method="POST" class="post-form" enctype="multipart/form-data"style="
    margin: auto;">
          {% csrf_token %}

          <div class="filebox"> <input class="upload-name" value="파일선택" disabled="disabled"> 
            <label for="id_soundfile" style="margin-bottom: 0px;">업로드</label> 
            <input type="file" name="soundfile" id="id_soundfile" class="upload-hidden"> 
        </div>

            <br>
            <div id="waveform_container">
              <div id="waveform"></div>
          </div>
              <div id="controlBar">
                  <div class="control_bar_row">
                      <div id="curTime" class="time-indicator" style="font-size: 1.5em;">00:00:00</div>
                      <div class="time-indicator-divider"style="font-size: 1.5em;">/</div>
                      <div id="fullTime" class="time-indicator"style="font-size: 1.5em;">00:00:00</div>
                      
                  </div>
                  <div class="control_bar_row">
                      <button id="play" type="button" class="video-play"style="width: 26px;    height: 26px;"></button>
                      <button id="stop" type="button" class="video-stop"style="width: 26px;    height: 26px;"></button>
                  </div>

              </div>
              <button id="sub_but" type="submit" class="btn btn-success" style="font-size: 2em;">분석하기</button>

                    </form>
      </div>

  </div>
<div class="loader" style="display:none;">
</div>
    <style>
        .loader {
    position: absolute;
    left: 50%;
    top: 50%;
    z-index: 1;
    width: 150px;
    height: 150px;
    margin: -75px 0 0 -75px;
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid #3498db;
    width: 120px;
    height: 120px;
    -webkit-animation: spin 2s linear infinite;
    animation: spin 2s linear infinite;
}


@-webkit-keyframes spin {
    0% { -webkit-transform: rotate(0deg); }
    100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


.filebox input[type="file"] { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip:rect(0,0,0,0); border: 0; } 
.filebox label { display: inline-block; padding: .5em .75em; color: #666; font-size: inherit; line-height: normal; vertical-align: middle; background-color: #fdfdfd; cursor: pointer; border: 1px solid #ebebeb; border-bottom-color: #e2e2e2; border-radius: .25em; font-family: 'Noto Sans KR';} /* named upload */ 
.filebox .upload-name { display: inline-block; padding: .5em .75em; /* label의 패딩값과 일치 */ font-size: inherit; font-family: inherit; line-height: normal; vertical-align: middle; background-color: #f5f5f5; border: 1px solid #ebebeb; border-bottom-color: #e2e2e2; border-radius: .25em; -webkit-appearance: none; /* 네이티브 외형 감추기 */ -moz-appearance: none; appearance: none; font-family: 'Noto Sans KR'; color: #666; }
#sub_but { display: inline-block; padding: .5em .75em; color: #666; font-size: inherit; line-height: normal; vertical-align: middle; background-color: #fdfdfd; border: 1px solid #ebebeb; border-bottom-color: #e2e2e2; border-radius: .25em; font-family: 'Noto Sans KR';} /* named upload */ 




    </style>
<!--
    <script>
        var _showPage = function() {
            var loader = $("div.loader");
            loader.css("display","block");
        };
    </script>-->

<style type="text/css">
#map_canvas { height:50%; width:60%; }

#id_file{ background-color: #FFFFFF; }

.div_wrap {
width:100%;
height:800px; 
margin:0px auto;
padding:0px; 
overflow:hidden;
text-align: center;
}

.content{
border:1px solid black;
width:90%;
height:90%;
margin:24px auto;
padding:0px;
overflow:hidden;
text-align:center;
}

.content:after {content:""; clear:both; display:block;}



.btn.btn-primary.btn-large {
margin-top: 10px;
width:60%;
height:60px; 
font-size: 30px;
}

#id_content{
height:100px; 
}

#pac-input {
background-color: #fff;
font-family: Roboto;
font-size: 15px;
font-weight: 300;
margin-left: 12px;
padding: 0 11px 0 13px;
text-overflow: ellipsis;
width: 400px;
height: 30px;
}

#info { height:50%; width:60%; }

#addControl {
width: 45%;
height: 100%;
float: left;
}

#sound_dropbox {
display: inline-block;
width: 100%;
height: 100%;
border: 5px solid #3C2F2E;
-moz-border-radius: 15px;
margin: 0;
}

#controlBar {
margin-top: 30px;
}

.control_bar_row {
margin: 20px 0 20px 0;
}

.range-bar-control {
margin: 20px 0 20px 0;
}


.video-play {
width:26px;
height:26px;
background-image: url("{% static 'img/play-26.png' %}");
}

.video-stop {
width:26px;
height:26px;
background: url("{% static 'img/stop-26.png' %}");
}

.ui-slider .ui-slider-handle{
background: url("{% static 'img/stop-26.png' %}");
}

.indicator-container {
display: inline-block;
position: absolute;
}

.indicator {
z-index:3;
height:100%;
width:3px;
background-color:#999;
position:absolute;
display:inline-block;
left:0%;
}

.indicator-rec {
z-index:2;
height:100%;
width:100%;
background-color: #ffffff;
position:absolute;
opacity: 0;
display:none;
left:0%;
opacity: 0.3;
}

.indicator-rec-back {
background-color: #000000;
}

.indicator-end{
left:100%;
}

.time-indicator{

margin: 0 10px 0 10px;
display: inline-block;
}

.time-indicator-divider{
width:5px;
text-align: center;
display: inline-block;
}


</style>
<!-- Google Maps Library load -->

<!-- WaveSurfer Library load -->
<script src="//cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.4.0/wavesurfer.min.js"></script>

<!-- WebAudioRecoder Library load -->

<script src="{% static 'js/recorder/WebAudioRecorder.min.js' %}"></script>
<script src="{% static 'js/recorder/WebAudioRecorderWav.min.js' %}"></script>

<!-- Slider Library load -->
<!--<script src="{% static 'js/slider/jquery-asRange.js' %}"></script>-->
<!--<link rel="stylesheet" href="{% static 'js/slider/css/asRange.css' %}">-->

<!-- Jquery JS-->
    <script src="{% static 'js/vendor/jquery-3.2.1.min.js' %}"></script>
    <!-- Bootstrap JS-->
    <script src="{% static 'js/vendor/bootstrap-4.1/popper.min.js' %}"></script>
    <script src="{% static 'js/vendor/bootstrap-4.1/bootstrap.min.js' %}"></script>
    <!-- Vendor JS       -->
    <script src="{% static 'js/vendor/slick/slick.min.js' %}">
    </script>
    <script src="{% static 'js/vendor/wow/wow.min.js' %}"></script>
    <script src="{% static 'js/vendor/animsition/animsition.min.js' %}"></script>
    <script src="{% static 'js/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js' %}">
    </script>
    <script src="{% static 'js/vendor/counter-up/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'js/vendor/counter-up/jquery.counterup.min.js' %}">
    </script>
    <script src="{% static 'js/vendor/circle-progress/circle-progress.min.js' %}"></script>
    <script src="{% static 'js/vendor/perfect-scrollbar/perfect-scrollbar.js' %}"></script>
    <script src="{% static 'js/vendor/chartjs/Chart.bundle.min.js' %}"></script>
    <script src="{% static 'js/vendor/select2/select2.min.js' %}">
    </script>


<script type="text/javascript">
  /* 오디오 파일 관련 스크립트 start */
  
  // 미리 지정한 색
  var predefinedColor = ["#7ebdcb", "#47C83E", "#FF0000", "#4641D9", "#FFBB00", "#000000"];
  // 범위 지정 바의 수
  var num = 0;
  // 전역 Wavesurfer
  var globalWavesurfer = null;

  // 남은 시간을 디스플레이하기 위한 텍스트 처리 함수
  // duration: 초
  // "00:00:00"와 같은 시분초 텍스트 형태로 반환
  function durationParsing(duration){
    var hours = Math.floor(duration / 3600);
    duration %= 3600;
    var minutes = Math.floor(duration / 60);
    var seconds = Math.floor(duration % 60);
    var txt = ("0" + hours).slice(-2) + ":" + ("0" + minutes).slice(-2) + ":" + ("0" + seconds).slice(-2);
    return txt;
  }

  // WaveSurfer 설정 함수
  // containerSelector: 웨이브폼 표시하는 공간
  // file: 오디오/비디오 파일
  // 설정된 Wavesurfer 반환
  function setWaveSurfer(containerSelector, file){
    var wavesurfer = WaveSurfer.create({
      container: containerSelector,
      waveColor: '#666',
      progressColor: '#eee'
    });
    wavesurfer.loadBlob(file);
    globalWavesurfer = wavesurfer;
    return wavesurfer;
  }

  // 파일이 오디오 혹은 비디오인지 체크
  function checkFileType(file){
    var videoType = /video.*/;
    var audioType = /audio.*/;
    var isVideoType = false;
    var isAudioType = false;

    if(file.type.match(videoType)){
      isVideoType = true;
    }
    else if(file.type.match(audioType)){
      isAudioType = true;
    }

    var status = {
      isVideo : isVideoType,
      isAudio : isAudioType
    }

    return status;
  }

  // 드래그앤드롭 및 input file 이벤트 처리 함수
  // isDrop: 드래그앤드랍 이벤트 여부
  function getFile(object, isDrop){
    var file = null;
    if(isDrop){
      var transfer = object.dataTransfer || object.originalEvent.dataTransfer;
      file = transfer.files[0];
    }else{
      file = object.files[0];
    }
    return file;
  }

  // Wavesurfer 메인 컨트롤 함수
  // Wavesurfer의 기본 이벤트 설정
  function setInitMainPlayer(wavesurfer){
    // Play 버튼, Pause 버튼 이벤트 설정
    $("#play").on("click", function(){
      wavesurfer.playPause();
      if(wavesurfer.isPlaying()==true){
        $(this).css("background", 'url("{% static 'img/pause-26.png' %}")');
      }else{
        $(this).css("background", 'url("{% static 'img/play-26.png' %}")');
      }
    });

    // 전체 길이 표기
    var dur = wavesurfer.getDuration();
    var durText = durationParsing(dur);
    $("#fullTime").text(durText);

    // Stop 버튼 이벤트 설정
    $("#stop").on("click", function(){
      wavesurfer.stop();
    });
  }

  // Wavesurfer 현재 재생 시간 표기 이벤트
  function playingEvent(wavesurfer){
    wavesurfer.on("audioprocess", function () {
      $("#curTime").text(durationParsing(wavesurfer.getCurrentTime()));
    });
  }

  // 범위 지정 표기 레이아웃 함수
  // rangeBar: 범위 지정 표시 레이아웃을 컨트롤하는 바
  // number: 컨트롤 바의 넘버
  function prepareIndicator(rangeBar, number){
    // 레이아웃 컨테이너 생성 및 설정
    var indicatorContainer = $("<div id='indicator-container" + number + "' class='indicator-container'></div>");
    indicatorContainer.appendTo($("#waveform"));
    indicatorContainer.css("width", $("#waveform").css("width"));
    var h = $("#waveform").css("height");
    indicatorContainer.css("height", h);
    var w = $("#waveform").css("width");
    var w1 = Number(w.replace("px", "")) / 2;
    var w2 = String(w1);
    indicatorContainer.css("margin-left", "-" + w2 + "px");
    indicatorContainer.css("margin-top", "-" + h);

    // 세부 레이아웃 설정
    var node = $("<div id='indicator-rec" + number + "' class='indicator-rec'></div>");
    node.appendTo(indicatorContainer);
    node = $("<div id='indicator-rec-left" + number + "' class='indicator-rec indicator-rec-back'></div>");
    node.appendTo(indicatorContainer);
    node = $("<div id='indicator-rec-right" + number + "' class='indicator-rec indicator-rec-back'></div>");
    node.appendTo(indicatorContainer);
    node = $("<div id='indicator-start"  + number + "' class='indicator indicator-start'></div>");
    node.appendTo(indicatorContainer);
    node = $("<div id='indicator-end"  + number + "' class='indicator indicator-end'></div>");
    node.appendTo(indicatorContainer);

    $("#indicator-container"+number+" .indicator").css("background-color", predefinedColor[number]);
    $("#indicator-container"+number+" .indicator").css("background-color", predefinedColor[number]);
  }

  // 범위 바 레이아웃 함수
  // number: 컨트롤 바의 넘버
  function setRangeBar(wavesurfer, number){
    // 컨트롤 바 컨테이너 생성
    var container = $("<div id='range-bar-container" + number + "' class='range-bar-container'></div>");
    var rangeBar = $("<div id='range-bar" + number + "' class='range-bar'></div>");
    var rangeBarControl = $("<div id='range-bar-control" + number + "' class='range-bar-control'></div>");
    container.appendTo($("#addControl"));
    rangeBar.appendTo(container);
    rangeBarControl.appendTo(container);


    // 세부 레이아웃 설정
    var duration = wavesurfer.getDuration();

    var startTime = $("<div id='startTime" + number + "' class='time-indicator'>00:00:00</div>");
    var divider = $("<div class='time-indicator-divider'>/</div>");
    var endTime = $("<div id='endTime" + number + "' class='time-indicator'>"+durationParsing(duration)+"</div>");
    var playButton = $("<button id='play" + number + "' class='video-play'></button>");
    var stopButton = $("<button id='stop" + number + "' class='video-stop'></button>");
    var extractButton = $("<button id='extraction-button" + number + "' class='extraction-button'>extract</button>");
    var inputName = $("<input id='input-name" + number + "' class='input-name'/>");

    startTime.appendTo(rangeBarControl);
    divider.appendTo(rangeBarControl);
    endTime.appendTo(rangeBarControl);
    playButton.appendTo(rangeBarControl);
    stopButton.appendTo(rangeBarControl);
    extractButton.appendTo(rangeBarControl);
    inputName.appendTo(rangeBarControl);

    // 컨트롤 바 설정
    rangeBar.asRange({
      range: true,
      step: 0.01,
      min: 0,
      max: duration,
      limit: false,
      tip: false,
    });
    rangeBar.asRange('set', [0, duration]);
    rangeBar.css("width", "100%");

    $("#range-bar"+number+" .asRange-selected").css("background-color", predefinedColor[number]);
    $("#styleDiv").append("<style>#range-bar"+number+" .asRange-pointer:before {background:"+ predefinedColor[number]+";border: 1px solid #ffffff;}</style>");

    // 컨트롤 바와 상응하는 범위 지정 표기 레이아웃 생성
    prepareIndicator(rangeBar, number);

    // 추출 버튼 이벤트 설정
    extractButton.on("click", function(e){
      var idNumber = e.target.id[-1];
      extractAudio(wavesurfer, number);
    });
  }

  // 범위 바-표시 레이아웃 연동 이벤트 처리 함수
  // 바를 움직이면 레이아웃을 변화
  // number: 컨트롤 바의 넘버
  function setRangeBarEvent(number){
    // 변화 이벤트
    $("#range-bar"+number).on('asRange::change', function(event){
      var value = $("#range-bar"+number).asRange('get');
      var minValue = value[0];
      var maxValue = value[1];
      var minText = durationParsing(minValue);
      var maxText = durationParsing(maxValue);
      $("#startTime"+number).text(minText);
      $("#endTime"+number).text(maxText);

      var totalWidth = $("#range-bar"+number).css('width');
      totalWidth = totalWidth.slice(0, totalWidth.length-2);
      var curLocation1 = $("#range-bar"+number+" .asRange-pointer-1").css('left');
      var curLocation2 = $("#range-bar"+number+" .asRange-pointer-2").css('left');
      curLocation1 = curLocation1.slice(0, curLocation1.length-2);
      curLocation2 = curLocation2.slice(0, curLocation2.length-2);

      var percentage1 = 100 * (curLocation1 / totalWidth);
      var percentage2 = 100 * (curLocation2 / totalWidth);

      $("#indicator-start"+number).css("left",percentage1+"%");
      $("#indicator-end"+number).css("left",percentage2+"%");

      var wid = curLocation2 - curLocation1;
      $("#indicator-rec"+number).css({"left": percentage1+"%", "width":wid+"px", "display":"inline-block"});
      $("#indicator-rec-left"+number).css({"width":curLocation1+"px","display":"inline-block"});
      wid = totalWidth-curLocation2;
      $("#indicator-rec-right"+number).css({"width":wid+"px","left": percentage2+"%","display":"inline-block"});
    });

    // 변화 종료 이벤트
    $("#range-bar"+number).on('asRange::moveEnd', function(event){
      $("#indicator-rec"+number).css("display", "none");
      $("#indicator-rec-left"+number).css("display", "none");
      $("#indicator-rec-right"+number).css("display", "none");
    });
  }

  // 부분 재생 함수
  // number: 컨트롤 바의 넘버
  function setClipPlayStopEvent(wavesurfer, number){
    // 부분 재생 및 일시 정지
    $("#play"+number).on('click', function(event){
      if(!wavesurfer.isPlaying()){
        var totalWidth = $("#range-bar"+number).css('width');
        totalWidth = totalWidth.slice(0, totalWidth.length-2);
        var duration = wavesurfer.getDuration();
        var curLocation1 = $("#range-bar"+number+" .asRange-pointer-1").css('left');
        var curLocation2 = $("#range-bar"+number+" .asRange-pointer-2").css('left');
        curLocation1 = curLocation1.slice(0, curLocation1.length-2);
        curLocation2 = curLocation2.slice(0, curLocation2.length-2);
        var loc1 = duration * (curLocation1 / totalWidth);
        var loc2 = duration * (curLocation2 / totalWidth);
        wavesurfer.play(loc1, loc2);
        $(this).css("background", 'url("{% static 'img/pause-26.png' %}")');
      }else{
        wavesurfer.pause();
        $(this).css("background", 'url("{% static 'img/play-26.png' %}")');
      }
    });

    // 정지 이벤트
    $("#stop"+number).on("click", function(){
      wavesurfer.stop();
    });
  }

  // 파일 메타데이터 불러오는 함수
  // file: 대상 파일
  function getFileMeta(file, wavesurfer){
    var fileSize = file.size || file.fileSize;
    var fileName = file.name;
    var splitTokens = fileName.split(".");
    var fileEx = splitTokens[splitTokens.length-1];
    var duration = wavesurfer.getDuration();

    console.log(fileSize);
    console.log(file.name);
    console.log(fileEx);
    console.log(duration);
  }

  // 파일 등록 이벤트 함수
  // 아직 삭제 이벤트는 추가하지 않음!
  // file: 대상 파일
  
  function addFileIcon(file){
    var fileInfoDiv = document.createElement("div");
    var fileIconDiv = document.createElement("img");
    fileIconDiv.src = "{% static 'img/video-file-48.png' %}";
    var fileNameDiv = document.createElement("div");
    fileNameDiv.innerHTML = file.name;
    var fileDeleteDiv = document.createElement("img");
    fileDeleteDiv.src = "{% static 'img/delete-26.png' %}";
    fileInfoDiv.appendChild(fileIconDiv);
    fileInfoDiv.appendChild(fileNameDiv);
    fileInfoDiv.appendChild(fileDeleteDiv);
    //var uploadedList = document.getElementById("sound_dropbox");
    //uploadedList.appendChild(fileInfoDiv);
  }

  // 파일 업로드 시도 처리 함수
  // file: 대상 파일
  function fileProcess(file){
    var fileType = checkFileType(file);
    var isVideo = fileType.isVideo;
    var isAudio = fileType.isAudio;

    var reader = new FileReader();
    console.log(file)
    // 파일 읽어올 경우 이벤트 처리
    reader.onload=function(e){
      // Wavesurfer 설정
      var wavesurfer = setWaveSurfer('#waveform', file);

      // Waversurfer가 준비되면 차례대로 처리
      wavesurfer.on('ready', function(){

        setInitMainPlayer(wavesurfer);
        playingEvent(wavesurfer);

        // setRangeBar(wavesurfer, num);
        // setRangeBarEvent(num);
        // setClipPlayStopEvent(wavesurfer, num);
        // num += 1;

        // 범위 지정 바 추가
        // $("#add-button").on('click', function(event){
        //   setRangeBar(wavesurfer, num);
        //   setRangeBarEvent(num);
        //   setClipPlayStopEvent(wavesurfer, num);
        //   num += 1;
        // });

        getFileMeta(file, wavesurfer);
      });

      addFileIcon(file);
    }

    // 비디오나 오디오일 경우 파일 읽어옴
    if(isVideo || isAudio){
      reader.readAsArrayBuffer(file);
    }
  }

  // 오디오 부분 추출 함수
  // number: 컨트롤 바의 넘버
  function extractAudio(wavesurfer, number){
    var strStartTime = $("#startTime"+number).text();
    var strEndTime = $("#endTime"+number).text();

    // 범위 찾음
    var strStartTimeTokens = strStartTime.split(":");
    var hourInSec = 3600 * parseInt(strStartTimeTokens[0]);
    var minuteInSec = 60 * parseInt(strStartTimeTokens[1]);
    var sec = parseInt(strStartTimeTokens[2]);
    var totalStartSec = hourInSec + minuteInSec + sec;

    var strEndTimeTokens = strEndTime.split(":");
    hourInSec = 3600 * parseInt(strEndTimeTokens[0]);
    minuteInSec = 60 * parseInt(strEndTimeTokens[1]);
    sec = parseInt(strEndTimeTokens[2]);
    var totalEndSec = hourInSec + minuteInSec + sec;

    // 버퍼로 긁어옴
    var originalBuffer = wavesurfer.backend.buffer;
    var segmentDuration = totalEndSec - totalStartSec;
    var startPosition = totalStartSec * originalBuffer.sampleRate;

    var audioCtx = new (window.AudioContext|| window.webkitAudioContext)();

    var emptySegment = audioCtx.createBuffer(
      originalBuffer.numberOfChannels,
      segmentDuration * originalBuffer.sampleRate,
      originalBuffer.sampleRate
      );
    for (var i = 0; i < originalBuffer.numberOfChannels; i++) {
      var chanData = originalBuffer.getChannelData(i);
      var segmentChanData = emptySegment.getChannelData(i);
      for (var j = 0, len = chanData.length; j < len; j++) {
        segmentChanData[j] = chanData[j+startPosition];
      }
    }
    var newBuffer = []
    for (var i = 0; i < originalBuffer.numberOfChannels; i++) {
      newBuffer.push(emptySegment.getChannelData(i));
    }

    var source = audioCtx.createBufferSource();
    source.buffer = emptySegment;
    source.connect(audioCtx.destination);

    // blob 형태로 저장
    var encoder = new WavAudioEncoder(originalBuffer.sampleRate, originalBuffer.numberOfChannels);
    console.log(newBuffer);
    encoder.encode(newBuffer);
    var blob = encoder.finish();
    console.log("blob:",blob);
    console.log("blob:",blob);
    var html, time, url;
    time = new Date();
    url = URL.createObjectURL(blob);
    console.log(url);

    // 접근 링크 보이기
    var hf = document.createElement('a');
    hf.href = url;
    hf.style.backgroundColor = "black";
    hf.download = new Date().toISOString() + '.wav';
    hf.innerHTML = hf.download;
    document.getElementById("range-bar-container"+number).appendChild(hf);
  }

  // 업로드용 오디오 부분 추출 함수
  function extractAudioForUp(wavesurfer, number){
    var strStartTime = $("#startTime"+number).text();
    var strEndTime = $("#endTime"+number).text();

    var strStartTimeTokens = strStartTime.split(":");
    var hourInSec = 3600 * parseInt(strStartTimeTokens[0]);
    var minuteInSec = 60 * parseInt(strStartTimeTokens[1]);
    var sec = parseInt(strStartTimeTokens[2]);
    var totalStartSec = hourInSec + minuteInSec + sec;

    var strEndTimeTokens = strEndTime.split(":");
    hourInSec = 3600 * parseInt(strEndTimeTokens[0]);
    minuteInSec = 60 * parseInt(strEndTimeTokens[1]);
    sec = parseInt(strEndTimeTokens[2]);
    var totalEndSec = hourInSec + minuteInSec + sec;

    var originalBuffer = wavesurfer.backend.buffer;
    var segmentDuration = totalEndSec - totalStartSec;
    var startPosition = totalStartSec * originalBuffer.sampleRate;

    var audioCtx = new (window.AudioContext|| window.webkitAudioContext)();

    var emptySegment = audioCtx.createBuffer(
      originalBuffer.numberOfChannels,
      segmentDuration * originalBuffer.sampleRate,
      originalBuffer.sampleRate
      );
    for (var i = 0; i < originalBuffer.numberOfChannels; i++) {
      var chanData = originalBuffer.getChannelData(i);
      var segmentChanData = emptySegment.getChannelData(i);
      for (var j = 0, len = chanData.length; j < len; j++) {
        segmentChanData[j] = chanData[j+startPosition];
      }
    }
    var newBuffer = []
    for (var i = 0; i < originalBuffer.numberOfChannels; i++) {
      newBuffer.push(emptySegment.getChannelData(i));
    }

    var source = audioCtx.createBufferSource();
    source.buffer = emptySegment;
    source.connect(audioCtx.destination);

    var encoder = new WavAudioEncoder(originalBuffer.sampleRate, originalBuffer.numberOfChannels);
    console.log(newBuffer);
    encoder.encode(newBuffer);
    var blob = encoder.finish();
    console.log(blob);

    var file = new File([blob], "tempo");
    console.log(file);
    return file;
  }

  // 이벤트 설정
  $(document).ready(function(){


    $("#id_soundfile").on("change", function(){
        //$("#waveform_container").remove("#waveform");
        //$("#waveform_container").append('<div id="waveform"></div>');
        var file = getFile(this, false);

        fileProcess(file);
    });

  });





  </script>


<script type="text/javascript">
    
(function ($) {
  // USE STRICT
  "use strict";
  // Sublist Sidebar
  try {
    var arrow = $('.js-arrow');
    arrow.each(function () {
      var that = $(this);
      that.on('click', function (e) {
        e.preventDefault();
        that.find(".arrow").toggleClass("up");
        that.toggleClass("open");
        that.parent().find('.js-sub-list').slideToggle("250");
      });
    });

  } catch (error) {
    console.log(error);
  }


  try {
    // Hamburger Menu
    $('.hamburger').on('click', function () {
      $(this).toggleClass('is-active');
      $('.navbar-mobile').slideToggle('500');
    });
    $('.navbar-mobile__list li.has-dropdown > a').on('click', function () {
      var dropdown = $(this).siblings('ul.navbar-mobile__dropdown');
      $(this).toggleClass('active');
      $(dropdown).slideToggle('500');
      return false;
    });
  } catch (error) {
    console.log(error);
  }
})(jQuery);
(function ($) {
  // USE STRICT
  "use strict";

  // Load more
  try {
    var list_load = $('.js-list-load');
    if (list_load[0]) {
      list_load.each(function () {
        var that = $(this);
        that.find('.js-load-item').hide();
        var load_btn = that.find('.js-load-btn');
        load_btn.on('click', function (e) {
          $(this).text("Loading...").delay(1500).queue(function (next) {
            $(this).hide();
            that.find(".js-load-item").fadeToggle("slow", 'swing');
          });
          e.preventDefault();
        });
      })

    }
  } catch (error) {
    console.log(error);
  }

})(jQuery);
(function ($) {
  // USE STRICT
  "use strict";

  try {
    
    $('[data-toggle="tooltip"]').tooltip();

  } catch (error) {
    console.log(error);
  }

  // Chatbox
  try {
    var inbox_wrap = $('.js-inbox');
    var message = $('.au-message__item');
    message.each(function(){
      var that = $(this);

      that.on('click', function(){
        $(this).parent().parent().parent().toggleClass('show-chat-box');
      });
    });
    

  } catch (error) {
    console.log(error);
  }

})(jQuery);




$(document).ready(function(){ var fileTarget = $('.filebox .upload-hidden'); fileTarget.on('change', function(){ // 값이 변경되면 
if(window.FileReader){ // modern browser 
var filename = $(this)[0].files[0].name; } else { // old IE 
var filename = $(this).val().split('/').pop().split('\\').pop(); // 파일명만 추출 
} // 추출한 파일명 삽입 
$(this).siblings('.upload-name').val(filename); 
}); 
});



</script>
  {% endblock %}